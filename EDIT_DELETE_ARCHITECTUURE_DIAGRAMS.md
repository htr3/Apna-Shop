# ğŸ“Š Edit Sale & Delete Sale - Architecture & Flow Diagrams

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT (React Frontend)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Sales Page Component                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ useSales() - Fetch all sales                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ useUpdateSale() - Mutate sale edits                â”‚  â”‚
â”‚  â”‚  â”œâ”€ useDeleteSale() - Mutate sale deletes              â”‚  â”‚
â”‚  â”‚  â””â”€ <SaleRow /> - Renders each sale with buttons      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                          â”‚                             â”‚
â”‚         â–¼                          â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚Edit Dialog  â”‚          â”‚Delete Dialogâ”‚                      â”‚
â”‚  â”‚(form inputs)â”‚          â”‚(confirmation)                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚         â”‚                          â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ PUT /api/sales/:id       â”‚ DELETE /api/sales/:id
          â”‚ with token               â”‚ with token
          â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SERVER (Express Backend)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Routes (server/routes.ts)                               â”‚  â”‚
â”‚  â”‚  â”œâ”€ PUT /api/sales/:id                                  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ authenticateToken middleware                    â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Validate input with Zod                      â”‚  â”‚
â”‚  â”‚  â”‚        â””â”€ Call storage.updateSale()                â”‚  â”‚
â”‚  â”‚  â”‚           â””â”€ Return updated sale                    â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â””â”€ DELETE /api/sales/:id                              â”‚  â”‚
â”‚  â”‚     â””â”€ authenticateToken middleware                    â”‚  â”‚
â”‚  â”‚        â””â”€ Call storage.deleteSale()                   â”‚  â”‚
â”‚  â”‚           â””â”€ Return { success: true }                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                          â”‚                             â”‚
â”‚         â–¼                          â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Storage Layer (server/storage.ts)                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ updateSale()                                        â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Check ownership (mobileNo matches)             â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ UPDATE sales table                             â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Return updated sale                            â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â””â”€ deleteSale()                                       â”‚  â”‚
â”‚  â”‚     â”œâ”€ Check ownership (mobileNo matches)             â”‚  â”‚
â”‚  â”‚     â”œâ”€ DELETE from sales table                        â”‚  â”‚
â”‚  â”‚     â””â”€ Return success flag                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                          â”‚                             â”‚
â”‚         â–¼                          â–¼                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    DATABASE (PostgreSQL)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Table: sales                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ id (PK)                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ mobileNo (FK to users, for ownership check)        â”‚  â”‚
â”‚  â”‚  â”œâ”€ paymentMethod (UPDATED or DELETED)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ paidAmount (UPDATED or DELETED)                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ pendingAmount (UPDATED or DELETED)                 â”‚  â”‚
â”‚  â”‚  â””â”€ ... other columns                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Edit Sale Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Clicks â”‚
â”‚  Edit Btn   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SaleRow Component              â”‚
â”‚  setIsEditOpen(true)            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dialog Component Opens         â”‚
â”‚  Shows Form with Current Data   â”‚
â”‚  â”œâ”€ Payment Method              â”‚
â”‚  â”œâ”€ Amount Paid                 â”‚
â”‚  â””â”€ Amount Pending              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Edits Form                â”‚
â”‚  onChange Events Update State   â”‚
â”‚  setEditData({...})             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Clicks Save               â”‚
â”‚  handleUpdateSale() called      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  updateSale.mutate({            â”‚
â”‚    id: sale.id,                 â”‚
â”‚    data: { ... }                â”‚
â”‚  })                             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP PUT Request
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend: PUT /api/sales/:id    â”‚
â”‚  â”œâ”€ Verify JWT Token            â”‚
â”‚  â”œâ”€ Validate Input (Zod)        â”‚
â”‚  â”œâ”€ Check Ownership (mobileNo)  â”‚
â”‚  â”œâ”€ UPDATE sales table          â”‚
â”‚  â””â”€ Return updated sale         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Response { id, paymentMethod, ... }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend: Success Handler      â”‚
â”‚  â”œâ”€ queryClient.invalidate()    â”‚
â”‚  â”‚  (sales list cache)          â”‚
â”‚  â”œâ”€ queryClient.invalidate()    â”‚
â”‚  â”‚  (dashboard cache)           â”‚
â”‚  â”œâ”€ setIsEditOpen(false)        â”‚
â”‚  â”‚  (close dialog)              â”‚
â”‚  â””â”€ toast({ success })          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Query Refetches:         â”‚
â”‚  â”œâ”€ useSales() hook             â”‚
â”‚  â”œâ”€ useDashboardStats() hook    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Automatically Updates:      â”‚
â”‚  â”œâ”€ Table refreshes with new   â”‚
â”‚  â”‚  payment method             â”‚
â”‚  â”œâ”€ Dashboard recalculates     â”‚
â”‚  â”‚  stats                      â”‚
â”‚  â””â”€ Dialog closes              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‘ï¸ Delete Sale Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Clicks â”‚
â”‚ Delete Btn  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  handleDelete() called          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Browser confirm() Dialog       â”‚
â”‚  "Are you sure?"                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ User clicks Cancel
       â”‚  â””â”€ Function returns (nothing happens)
       â”‚
       â”œâ”€ User clicks OK
       â”‚  â””â”€ Continues below
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  deleteSale.mutate(sale.id)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP DELETE Request
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: DELETE /api/sales/:id  â”‚
â”‚  â”œâ”€ Verify JWT Token            â”‚
â”‚  â”œâ”€ Check Ownership (mobileNo)  â”‚
â”‚  â”œâ”€ DELETE from sales table     â”‚
â”‚  â””â”€ Return { success: true }    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Response { success: true }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend: Success Handler      â”‚
â”‚  â”œâ”€ queryClient.invalidate()    â”‚
â”‚  â”‚  (sales list cache)          â”‚
â”‚  â”œâ”€ queryClient.invalidate()    â”‚
â”‚  â”‚  (dashboard cache)           â”‚
â”‚  â””â”€ toast({ success })          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Query Refetches:         â”‚
â”‚  â”œâ”€ useSales() hook             â”‚
â”‚  â”œâ”€ useDashboardStats() hook    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Automatically Updates:      â”‚
â”‚  â”œâ”€ Sale row disappears         â”‚
â”‚  â”œâ”€ Table refreshes             â”‚
â”‚  â”œâ”€ Dashboard recalculates      â”‚
â”‚  â”‚  totals                      â”‚
â”‚  â””â”€ Success toast shown         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© Component Hierarchy

```
<Sales /> (Main Page Component)
â”œâ”€ Header Section
â”‚  â”œâ”€ Title
â”‚  â”œâ”€ Search Input
â”‚  â””â”€ "New Sale" Button
â”‚
â”œâ”€ Table Component
â”‚  â”œâ”€ <thead>
â”‚  â”‚  â””â”€ Header Row (Date, Customer, Method, Amount, Actions)
â”‚  â”‚
â”‚  â””â”€ <tbody>
â”‚     â””â”€ {filteredSales.map(sale => (
â”‚        <SaleRow key={sale.id} sale={sale} />
â”‚     ))}
â”‚
â””â”€ Dialog Component (for adding new sales)
   â””â”€ <AddSaleForm />

<SaleRow /> (Child Component - One per Sale)
â”œâ”€ Table Row Cells
â”‚  â”œâ”€ Date Cell
â”‚  â”œâ”€ Customer Cell
â”‚  â”œâ”€ Amount Cell
â”‚  â””â”€ Method Cell
â”‚
â””â”€ Actions Cell
   â”œâ”€ Dialog Component (Edit)
   â”‚  â”œâ”€ EditDialog Header
   â”‚  â”œâ”€ EditForm
   â”‚  â”‚  â”œâ”€ Payment Method Selector
   â”‚  â”‚  â”œâ”€ Amount Paid Input
   â”‚  â”‚  â””â”€ Amount Pending Input
   â”‚  â””â”€ Save/Cancel Buttons
   â”‚
   â””â”€ Delete Button
      â””â”€ Confirmation Dialog
```

---

## ğŸ” Authentication & Authorization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Enters      â”‚
â”‚ Credentials      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Login Request    â”‚
â”‚ POST /api/login  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend          â”‚
â”‚ Validates        â”‚
â”‚ Credentials      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate JWT Token           â”‚
â”‚ {                            â”‚
â”‚   userId: 1,                 â”‚
â”‚   username: "owner",         â”‚
â”‚   mobileNo: "9999999999",    â”‚
â”‚   role: "OWNER"              â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Store Token in localStorage  â”‚
â”‚ authToken = "eyJhbG..."      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edit/Delete Request          â”‚
â”‚ Headers: {                   â”‚
â”‚   Authorization:             â”‚
â”‚   "Bearer eyJhbG..."         â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: authenticateToken   â”‚
â”‚ â”œâ”€ Extract token from header â”‚
â”‚ â”œâ”€ Verify JWT signature      â”‚
â”‚ â”œâ”€ Decode token              â”‚
â”‚ â””â”€ Attach user to req.user   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check Ownership              â”‚
â”‚ Is user's mobileNo ==        â”‚
â”‚ sale's mobileNo?             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚
    â”œâ”€Yes    â”œâ”€No
    â”‚        â”‚
    â–¼        â–¼
  Allow    Deny
  (200)    (404/403)
```

---

## ğŸ“¦ Data Flow Diagram

```
Redux Store (React Query Cache)
â”œâ”€ sales: [
â”‚  {
â”‚    id: 1,
â”‚    mobileNo: "9999999999",
â”‚    amount: "1000",
â”‚    paidAmount: "700",
â”‚    pendingAmount: "300",
â”‚    paymentMethod: "CASH",
â”‚    ...
â”‚  },
â”‚  ...
â”‚ ]
â”‚
â””â”€ dashboardStats: {
   todaySales: 5000,
   monthSales: 50000,
   pendingUdhaar: 3000,
   ...
  }

When Edit/Delete Happens:
1. Mutation fires
2. Optimistic update (optional)
3. API request sent
4. Response received
5. Cache invalidated
6. Queries refetch
7. UI updates
```

---

## ğŸ›¡ï¸ Security Layers

```
â”Œâ”€ API Request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                       â”‚
â”œâ”€ Layer 1: CORS Check                 â”‚
â”‚  â””â”€ Verify origin is allowed         â”‚
â”‚                                       â”‚
â”œâ”€ Layer 2: JWT Verification           â”‚
â”‚  â”œâ”€ Extract token from header        â”‚
â”‚  â”œâ”€ Verify signature                 â”‚
â”‚  â””â”€ Check token expiry               â”‚
â”‚                                       â”‚
â”œâ”€ Layer 3: User Authentication        â”‚
â”‚  â””â”€ User attached to req.user        â”‚
â”‚                                       â”‚
â”œâ”€ Layer 4: Input Validation           â”‚
â”‚  â”œâ”€ Parse with Zod schema            â”‚
â”‚  â”œâ”€ Type check                       â”‚
â”‚  â””â”€ Value validation                 â”‚
â”‚                                       â”‚
â”œâ”€ Layer 5: Ownership Check            â”‚
â”‚  â”œâ”€ Fetch sale from DB               â”‚
â”‚  â”œâ”€ Compare user.mobileNo            â”‚
â”‚  â”‚  with sale.mobileNo               â”‚
â”‚  â””â”€ Deny if mismatch                 â”‚
â”‚                                       â”‚
â””â”€ Layer 6: Database Operation         â”‚
   â”œâ”€ Execute UPDATE/DELETE            â”‚
   â”œâ”€ Return result                    â”‚
   â””â”€ Rollback on error                â”‚
```

---

## ğŸ“ˆ Performance Optimization

```
User Edits Sale
â”‚
â”œâ”€ Debounce Input (optional)
â”‚  â””â”€ Wait 300ms before sending
â”‚
â”œâ”€ Validate Client-Side
â”‚  â””â”€ Catch errors early
â”‚
â”œâ”€ React Query Caching
â”‚  â”œâ”€ Cache sales list
â”‚  â”œâ”€ Cache dashboard stats
â”‚  â””â”€ Reuse data when possible
â”‚
â”œâ”€ Optimistic Updates (optional)
â”‚  â””â”€ Update UI before response
â”‚
â””â”€ Background Refetches
   â”œâ”€ Refetch when needed
   â”œâ”€ Only if cache is stale
   â””â”€ Don't hammer server
```

---

## ğŸ¯ Error Handling Flow

```
Request Sent
â”‚
â–¼
â”Œâ”€ Network Error â”€â”€â”€â”€â”€â”€â”
â”‚  â”œâ”€ No response      â”‚
â”‚  â”œâ”€ Timeout          â”‚
â”‚  â””â”€ Connection lost  â”‚
â”‚     â””â”€ Retry logic   â”‚
â”‚        â””â”€ Show error â”‚
â”‚
â”œâ”€ 4xx Error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”œâ”€ 400: Bad input   â”‚
â”‚  â”œâ”€ 401: Unauthorized
â”‚  â”œâ”€ 403: Forbidden   â”‚
â”‚  â”œâ”€ 404: Not found   â”‚
â”‚  â””â”€ Show specific    â”‚
â”‚     error message    â”‚
â”‚
â”œâ”€ 5xx Error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”œâ”€ 500: Server err  â”‚
â”‚  â”œâ”€ 503: Unavailable â”‚
â”‚  â””â”€ Retry after      â”‚
â”‚     delay            â”‚
â”‚
â””â”€ Success Response â”€â”€â”€â”
   â”œâ”€ Validate shape   â”‚
   â”œâ”€ Update cache     â”‚
   â”œâ”€ Refresh UI       â”‚
   â””â”€ Show success     â”‚
      message          â”‚
```

---

This diagram provides a complete visual understanding of the Edit/Delete feature!

**Last Updated:** February 13, 2026

